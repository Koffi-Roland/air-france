meta {
  name: SIBM - PNM
  type: http
  seq: 9
}

post {
  url: {{search-individual-by-multicriteria-url}}
  body: xml
  auth: none
}

headers {
  SOAPAction: "http://www.af-klm.com/services/passenger/SearchIndividualByMulticriteriaService-v2/searchIndividual"
}

body:xml {
  <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
      <soapenv:Body>
          <ns2:SearchIndividualByMulticriteriaRequestElement xmlns:ns6="http://www.af-klm.com/services/passenger/SicCommonType-v1/xsd"
              xmlns:ns5="http://www.af-klm.com/services/passenger/SoftComputingType-v1/xsd"
              xmlns:ns7="http://www.af-klm.com/services/passenger/request-v1/xsd"
              xmlns:ns2="http://www.af-klm.com/services/passenger/data-v1/xsd"
              xmlns:ns4="http://www.af-klm.com/services/passenger/response-v1/xsd"
              xmlns:ns3="http://www.af-klm.com/services/passenger/SicIndividuType-v1/xsd">
              <populationTargeted>A</populationTargeted>
              <processType>A</processType>
              <requestor>
                  <channel>B2C</channel>
                  <applicationCode>CBS</applicationCode>
                  <site>QVI</site>
                  <signature>REGRESSION</signature>
              </requestor>
              <identification>
                  <identificationType>PNM</identificationType>
                  <identificationValue>{{pnm}}</identificationValue>
              </identification>
          </ns2:SearchIndividualByMulticriteriaRequestElement>
      </soapenv:Body>
  </soapenv:Envelope>
}

vars:pre-request {
  USER: w21375138
  PASSWORD: pswpsw123
  PNM_RCT: 8448BFE6-AF29-4DAC-8CD1-D5E6BEF2D30957456
  PNM_DEV: 8448BFE6-AF29-4DAC-8CD1-D5E6BEF2D30957456
}

assert {
  res.status: eq 200
}

script:pre-request {
  // START CODE
  console.log(currentEnv);
  if(envs.includes(currentEnv)) {
    replaceVar('FIRSTNAME', currentEnv, 'firstname');
    replaceVar('LASTNAME', currentEnv, 'lastname');
    replaceVar('DOB', currentEnv, 'dob');
    replaceVar('EMAIL', currentEnv, 'email');
    replaceVar('TELECOM', currentEnv, 'telecom');
    replaceVar('ADDRESS', currentEnv, 'address');
    replaceVar('COUNTRY_CODE', currentEnv, 'countryCode');
    replaceVar('PNM', currentEnv, 'pnm');
    replaceVar('SOCIAL', currentEnv, 'social');
    replaceVar('GIGYA', currentEnv, 'gigya');
  }
}

script:post-response {
  const replace = ['fistname', 'lastname', 'dob', 'email', 'telecom', 'address', 'countryCode', 'pnm', 'social', 'gigya'];
  
  const vars = ['FIRSTNAME', 'LASTNAME', 'DOB', 'EMAIL', 'TELECOM','ADDRESS', 'COUNTRY_CODE', 'PNM', 'SOCIAL', 'GIGYA'];
  
  clean(replace, null);
  clean(vars, envs);
}
