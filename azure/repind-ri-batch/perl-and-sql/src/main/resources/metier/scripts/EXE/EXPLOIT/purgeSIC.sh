#!/bin/bash
#
# Script de purge des traces et des donnees des batchs du SIC
#
# 19/01 1999
# AIR FRANCE - BENZENOU Joel
#

# Purge du repertoire de sauvegarde pour le batch Carte financiere
find $BASE_DATA_DIR/CARTEFI/SAVE -type f -exec rm {} \;

# Purge du repertoire de sauvegarde pour le batch de traitement de la chaine MembreShip Rewards 
find $BASE_DATA_DIR/AMEX -type f -exec rm {} \;

# Purge du repertoire de sauvegarde pour le batch de traitement des mouvements BDC
find $BASE_DATA_DIR/MAJ_REP/MVT -type f -exec rm {} \;

# Purge du repertoire de sauvegarde pour le batch de traitement des mouvements BDC numero 2
find $BASE_DATA_DIR/MVTBDC_TRAITES -type f -exec rm {} \;

# Purge du repertoire de sauvegarde pour le batch de traitement de la replication
find $BASE_DATA_DIR/REPLICATION_TRAITEE -type f -exec rm {} \;

# Purge du repertoire de sauvegarde pour le batch de traitement de la replication des firmes
find $BASE_DATA_DIR/REPLICATION_FIRME_TRAITEE -type f -exec rm {} \;
 
# Purge de la table tracking 
echo "DELETE FROM TRACKING WHERE SDATEMODIFICATION <= TRUNC(SYSDATE) - 90;" | sqlplus -S `secureSIC $SECURE_DATABASE_ACCESS_FILE_SIC READSIC`

#Purge a 5 ans (1825 jours)
find $BASE_DATA_DIR/REPLICATION_GENERIQUE/MVT -type f -mtime +1825 -exec \rm -f {} \;

#Purge a 2 ans (730 jours)
find $BASE_DIR/stats -type f -mtime +730 -exec \rm -f {} \; 
find $BASE_DATA_DIR/PURGE/BACKUP -type f -mtime +730 -exec \rm -f {} \;

# Purge a 1 an (366 jours)
find $BASE_DATA_DIR/AGENCES/BANDE_IATA/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/AGENCES/BANDE_ARC/RAPPORTS -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/AGENCES/BANDE_ARC/REJETS -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/AGENCES/BANDE_ARC/SOURCES -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/AGENCES/BANDES_GDS/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/AGENCES/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/AGENCES/SEQUOIA/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/FIRMES/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/FIRMES/LOAD_BDC/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/ONE_CARD -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/ONE_CARD/RESULTATS -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/CARTEFI/SAVE_FIRME -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/CARTEFI/NEW_BATCH -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/ADHESION_FREQUENCE_PLUS -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/ADHESION_FREQUENCE_PLUS/RESULTATS -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/ADHESION_FREQUENCE_PLUS/BACKUP -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/ADR_STAT/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/MAJ_REP_NEW/MVT -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/MEMBRE/HISTO -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/REPLICATION/ISI_BDC/REPLICATION_TRAITEE -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/REPLICATION_KLM -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/REPLICATION_GENERIQUE/GLOBAL-FIXE -type f -mtime +60 -exec \rm -f {} \;
find $BASE_DATA_DIR/REPLICATION_GENERIQUE/MVT-FIXE -type f -mtime +60 -exec \rm -f {} \;
find $BASE_DATA_DIR/SYNCHRO_ISIS/MVT -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/TIERS_LOCAUX/REGIONAL/BACKUP -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/TIERS_LOCAUX/CCE/BACKUP -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/QUALIF_ADRESSES/CRMPUSH_R3 -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/QUALIF_ADRESSES/CRMPUSH -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/QUALIF_ADRESSES/MOVERS -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/QUALIF_ADRESSES/INITIAL_CLEANING/RESULT -type f -mtime +366 -exec \rm -f {} \;
find $BASE_DATA_DIR/PREFILLED_NUMBER -type f -mtime +366 -exec \rm -f {} \;

# Purge a 30 jours
find $BASE_DATA_DIR/FIRMES/EVENT_NOTIFICATIONS -type f -mtime +30 -exec \rm -f {} \;
find $BASE_LOG_DIR/purge_trigger_change -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/PURGE/*.trace -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/PURGE_GDPR/*.trace -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/PROSPECT/processed -type f -mtime +30 -exec \rm -f {} \;

#purge des donnes du nettoyage des emails et adresses (suppression  30jrs)
find $BASE_DATA_DIR/CLEAN_MEDIA/EMAILS/data/WebPattern -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/CLEAN_MEDIA/EMAILS/data/TassementEmail -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/CLEAN_MEDIA/EMAILS/data/InvalCarSpecial -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/CLEAN_MEDIA/EMAILS -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/CLEAN_MEDIA/ADR_POST -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/CLEAN_MEDIA/ADR_POST/data/InvalCarSpecial -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/CLEAN_MEDIA/ADR_POST/data/Desaccentuation -type f -mtime +30 -exec \rm -f {} \;
find $BASE_DATA_DIR/CLEAN_MEDIA/ADR_POST/data/Blanchiment -type f -mtime +30 -exec \rm -f {} \;

#purge des logs des batchs java (et du batch lifecycle)
mv $BASE_LOG_DIR/traces_batch_java/stdout.log $BASE_LOG_DIR/traces_batch_java/stdout_old.log
find $BASE_LOG_DIR/traces_batch_java -type f -mtime +14 -exec \rm -f {} \;
find $BASE_LOG_DIR/traces_BatchLifeCycle -type f -mtime +14 -exec \rm -f {} \;
