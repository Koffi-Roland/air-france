<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
	http://www.springframework.org/schema/tx 
	http://www.springframework.org/schema/tx/spring-tx-3.0.xsd 		
	http://www.springframework.org/schema/context 
	http://www.springframework.org/schema/context/spring-context-3.0.xsd
	http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/aop
	http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"
>

	<bean id="persistenceUnitManager"
		class="org.springframework.orm.jpa.persistenceunit.DefaultPersistenceUnitManager">
		<property name="persistenceXmlLocations">
			<list>
				<value>META-INF/persistence-web-test.xml</value>
			</list>
		</property>
	</bean>
	<!-- Context de persistence -->
	<bean id="myEmf"
		class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="persistenceUnitManager" ref="persistenceUnitManager" />
		<property name="persistenceUnitName" value="myPersistenceUnit" />
	</bean>

	<!-- Properties -->
    <bean id="ppConfig" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="ignoreUnresolvablePlaceholders" value="true"/>
		<property name="locations">
			<list>
				<value>config/ws-test.properties</value>
			</list>
		</property>
	</bean>

	<!-- Context transactionnel -->
	<bean id="myTxManager"
		class="org.springframework.orm.jpa.JpaTransactionManager">
		<property name="entityManagerFactory" ref="myEmf" />
	</bean>
		
	<!-- EntityManagerFactory definition : JPA one -->
	<bean id="myEmf2" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="persistenceUnitManager"	ref="persistenceUnitManager" />
		<property name="persistenceUnitName" value="myPersistenceUnit2" />
	</bean>

	<!-- Transaction Manager definition : JPA one-->
	<bean id="myTxManager2" class="org.springframework.orm.jpa.JpaTransactionManager">
		<property name="entityManagerFactory" ref="myEmf2" />
	</bean>
	<tx:annotation-driven transaction-manager="myTxManager2" />
	<tx:annotation-driven transaction-manager="myTxManager"/>
	
		<!-- Appel du web service ProvideCustomer360View v3 -->
	<bean id="consumer_ProvideCustomer360View-v03" class="com.afklm.soa.spring.consumer.WebServiceConsumer">
		<property name="wsdlLocation" value="classpath:/META-INF/wsdl/w001580-v03/w001580-v03-policy.wsdl" />
		<property name="service" value="com.afklm.soa.stubs.w001580.v3.ProvideCustomer360ViewServiceV3" />
		<property name="endpointAddress" value="https://ws-qvi-rct.airfrance.fr/passenger/marketing/001580v03" />
		<property name="features">
			<list>
				<bean class="com.afklm.soa.wss.jaxws.ConsumerSecurityFeature">
					<property name="env" value="rct"/>
				</bean>
			</list>
		</property>
	</bean>

	<import resource="classpath:ioc/0-ref-commons-enterpriselayer-dependencies.xml" />
	<import resource="classpath:ioc/0-sic-commons-enterpriselayer-dependencies.xml"/>
    <import resource="classpath:ioc/0-sic-commons-enterpriselayer-dependencies-ss-utf8.xml"/>
	<import resource="classpath:ioc/0-sicutf8-commons-enterpriselayer-dependencies.xml"/>
	<import resource="application-wscontext-service-test.xml" />
	<aop:aspectj-autoproxy />
	<!-- context:component-scan base-package="com.airfrance,com.afklm" /-->
	<context:component-scan base-package="com.afklm" /> 
	<context:annotation-config />
</beans>
